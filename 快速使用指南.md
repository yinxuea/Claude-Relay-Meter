# 🚀 快速使用指南：自动版本更新与打包

## 一键发布新版本

### 最简单的用法

```bash
# 1. 发布补丁版本（修复小问题），并自动安装
npm run release:install

# 2. 发布次版本（新增功能），并自动安装
npm run release:install:minor

# 3. 发布主版本（重大更新），并自动安装
npm run release:install:major
```

## 实际测试示例

假设当前版本是 `1.0.10`：

### 示例 1：发布补丁版本（修复 bug）
```bash
npm run release
```
**结果**：
- 版本号：`1.0.10` → `1.0.11`
- 文件：`builds/claude-relay-meter-1.0.11.vsix`
- 不自动安装（需要手动安装）

### 示例 2：发布次版本（新增功能）
```bash
npm run release:install:minor
```
**结果**：
- 版本号：`1.0.10` → `1.0.11`（如果刚才运行了示例1）
- 编译项目
- 生成 VSIX 文件
- **自动安装到 VSCode**
- 需要重启 VSCode 生效

## 可用命令速查

| 命令 | 版本类型 | 自动安装 | 适用场景 |
|------|----------|----------|----------|
| `npm run release` | patch | 否 | 修复 bug，小改进 |
| `npm run release:patch` | patch | 否 | 同上 |
| `npm run release:minor` | minor | 否 | 新功能 |
| `npm run release:major` | major | 否 | 重大更新 |
| `npm run release:install` | patch | **是** | 快速修复 + 部署 |
| `npm run release:install:minor` | minor | **是** | 新功能 + 部署 |
| `npm run release:install:major` | major | **是** | 重大更新 + 部署 |

## 流程说明

执行 `npm run release:install` 时，脚本会自动：

1. ✅ **读取当前版本** - 从 `package.json` 读取
2. ✅ **递增版本号** - 自动更新到下一个版本
3. ✅ **编译代码** - TypeScript → JavaScript
4. ✅ **打包扩展** - 生成 `.vsix` 文件
5. ✅ **安装到 VSCode** - 使用 `code --install-extension`

## 验证安装

安装完成后，查看 VSCode 扩展列表：
- 按 `Ctrl+Shift+X`（Windows/Linux）或 `Cmd+Shift+X`（macOS）
- 搜索 "Claude Relay Meter"
- 确保版本号是最新的

## 输出文件位置

所有 VSIX 文件保存在 `builds/` 目录：
```
builds/
├── claude-relay-meter-1.0.11.vsix   ← 最新版本
├── claude-relay-meter-1.0.10.vsix
└── ...
```

## 注意事项

⚠️ **重要提醒**：
- 运行自动安装命令前，请确保 VSCode 已关闭
- 安装新版本后，需要重启 VSCode 才能生效
- 版本号会**永久**更新到 `package.json`，无法撤销
- 建议在发布前先测试：先运行 `npm run compile` 确保无错误

## 故障排除

### 问题：扩展安装失败
**解决**：手动安装
```bash
code --install-extension builds/claude-relay-meter-1.0.11.vsix --force
```

### 问题：编译错误
**解决**：检查代码
```bash
npm run compile
# 修复错误后再运行 release 命令
```

### 问题：`code` 命令不可用
**解决**：将 VSCode 添加到 PATH
```bash
# Windows (PowerShell)
$env:Path += ";C:\Program Files\Microsoft VS Code"
# 或
$env:Path += ";C:\Program Files (x86)\Microsoft VS Code"
```

## 推荐工作流

1. **开发完成**：代码修改完毕
2. **本地测试**：`npm run compile` 确保无错误
3. **运行发布**：`npm run release:install`（选择合适的版本类型）
4. **验证安装**：重启 VSCode，检查版本号
5. **提交代码**：将版本更新提交到 Git

---

🎉 **就这么简单！一条命令完成版本更新、打包和安装！**
